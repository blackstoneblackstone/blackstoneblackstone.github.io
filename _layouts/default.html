<!DOCTYPE html>
<html lang="{{ site.lang | default: 'zh-CN' }}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- 基础 SEO 标签 -->
    <title>{% if page.title %}{{ page.title }} | {% endif %}{{ site.title | default: site.name }}</title>
    <meta name="description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta name="keywords" content="{% if page.keywords %}{{ page.keywords }}{% else %}{{ site.keywords }}{% endif %}">
    <meta name="author" content="{{ site.author | default: site.name }}">
    <meta name="robots" content="index, follow">
    <meta name="language" content="{{ site.lang | default: 'zh-CN' }}">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    
    <!-- Open Graph 标签 -->
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% else %}website{% endif %}">
    <meta property="og:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    <meta property="og:url" content="{{ page.url | absolute_url }}">
    <meta property="og:site_name" content="{{ site.name }}">
    <meta property="og:locale" content="zh_CN">
    {% if page.image %}
    <meta property="og:image" content="{{ page.image | absolute_url }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    {% elsif site.logo %}
    <meta property="og:image" content="{{ site.logo | absolute_url }}">
    {% endif %}
    
    <!-- Twitter Card 标签 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}">
    <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}">
    {% if page.image %}
    <meta name="twitter:image" content="{{ page.image | absolute_url }}">
    {% elsif site.logo %}
    <meta name="twitter:image" content="{{ site.logo | absolute_url }}">
    {% endif %}
    
    <!-- 文章特定标签 -->
    {% if page.layout == 'post' %}
    <meta property="article:author" content="{{ site.author | default: site.name }}">
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}">
    <meta property="article:modified_time" content="{{ page.last_modified_at | default: page.date | date_to_xmlschema }}">
    {% for tag in page.tags %}
    <meta property="article:tag" content="{{ tag }}">
    {% endfor %}
    {% endif %}

    {% seo %}

    <link rel="shortcut icon" type="image/x-icon" href="{{site.baseurl}}/{{site.favicon}}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.7.0/style.min.css">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <!-- Google Fonts-->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700" rel="stylesheet">

    <!-- Bootstrap Modified -->
    <link rel="stylesheet" href="{{site.baseurl}}/assets/css/main.css">

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="{{site.baseurl}}/assets/css/theme.css">
    
    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="{{site.baseurl}}/assets/css/custom.css">
    
    <!-- Prism.js 代码高亮 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    
    <!-- Lottie.js 动画库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js" integrity="sha512-En+orQdQ4Uz2IxXDq8lqZwlqhguHDliwj4FpDxE9/vZAlZ4XvjwpFc4FTFv0KkP8iZpBONUQLfXhM5gkiKHaaw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Jquery on header to make sure everything works, the rest  of the scripts in footer for fast loading -->
    <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

    {% include tracking-header.html %}
    
    <!-- Google Search Console 验证 -->
    {% if site.google_site_verification %}
    <meta name="google-site-verification" content="{{ site.google_site_verification }}">
    {% endif %}
    
    <!-- Google Analytics -->
    {% if site.google_analytics %}
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics }}"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', '{{ site.google_analytics }}');
    </script>
    {% endif %}
    
    <!-- 结构化数据 (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "{% if page.layout == 'post' %}BlogPosting{% else %}WebSite{% endif %}",
        "name": "{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}",
        "description": "{% if page.description %}{{ page.description }}{% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}",
        "url": "{{ page.url | absolute_url }}",
        "author": {
            "@type": "Person",
            "name": "{{ site.author | default: site.name }}",
            "url": "{{ site.url }}"
        },
        "publisher": {
            "@type": "Organization",
            "name": "{{ site.name }}",
            "url": "{{ site.url }}",
            "logo": {
                "@type": "ImageObject",
                "url": "{{ site.logo | absolute_url }}"
            }
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "{{ page.url | absolute_url }}"
        }
        {% if page.layout == 'post' %},
        "datePublished": "{{ page.date | date_to_xmlschema }}",
        "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
        "headline": "{{ page.title }}",
        "image": "{% if page.image %}{{ page.image | absolute_url }}{% elsif site.logo %}{{ site.logo | absolute_url }}{% endif %}",
        "keywords": "{% if page.tags %}{{ page.tags | join: ', ' }}{% endif %}"
        {% endif %}
    }
    </script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MJYB280FP1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-MJYB280FP1');
    </script>
</head>

<body class="{% if page.url == "/" %} homefirstpage {% endif %}">

    <!-- Navbar -->
    <nav id="MagicMenu" class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <div class="container">
        <a class="navbar-brand" href="{{ site.baseurl }}/index.html">
            <img src="/assets/images/favicon.ico" alt="网站图标" height="30px" style="margin-top: -5px;">
            <strong>{{site.name}}</strong>
        </a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarColor02" style="">
            <ul class="navbar-nav mr-auto d-flex align-items-center">
               {% include menu-header.html %}
            </ul>
            <ul class="navbar-nav ml-auto d-flex align-items-center">
                {% include search-lunr.html %}
            </ul>
        </div>
    </div>
    </nav>

    <!-- Search Results -->
    <div id="lunrsearchresults">
        <ul class="mb-0"></ul>
    </div>

    <!-- Content -->
    <main role="main" class="site-content">
        {{ content }}
    </main>

    <!-- 图片查看器 -->
    <div class="image-viewer" id="imageViewer">
        <button class="close-btn" id="closeImageViewer">&times;</button>
        <img id="viewerImage" src="" alt="">
    </div>


    <!-- Scripts: popper, bootstrap, theme, lunr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <script src="{{site.baseurl}}/assets/js/theme.js"></script>
    
    <!-- Prism.js 代码高亮脚本 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <!-- 图片查看器脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageViewer = document.getElementById('imageViewer');
            const viewerImage = document.getElementById('viewerImage');
            const closeBtn = document.getElementById('closeImageViewer');
            
            // 为所有文章中的图片添加点击事件
            const articleImages = document.querySelectorAll('article img');
            
            articleImages.forEach(function(img) {
                img.addEventListener('click', function() {
                    viewerImage.src = this.src;
                    viewerImage.alt = this.alt;
                    imageViewer.classList.add('active');
                    document.body.style.overflow = 'hidden'; // 防止背景滚动
                });
            });
            
            // 关闭图片查看器
            function closeViewer() {
                imageViewer.classList.remove('active');
                document.body.style.overflow = 'auto'; // 恢复滚动
            }
            
            closeBtn.addEventListener('click', closeViewer);
            imageViewer.addEventListener('click', function(e) {
                if (e.target === imageViewer) {
                    closeViewer();
                }
            });
            
            // ESC 键关闭
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && imageViewer.classList.contains('active')) {
                    closeViewer();
                }
            });
        });
    </script>

    <!-- Lottie 动画初始化脚本 -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 检查 Lottie 是否可用
            if (typeof lottie === 'undefined') {
                console.warn('Lottie.js 未加载，动画将无法显示');
                return;
            }

            // 初始化所有 Lottie 动画
            const lottieContainers = document.querySelectorAll('.lottie-container');
            
            lottieContainers.forEach(function(container) {
                const animationPath = container.getAttribute('data-animation-path');
                const width = container.getAttribute('data-width');
                const height = container.getAttribute('data-height');
                const autoplay = container.getAttribute('data-autoplay') === 'true';
                const loop = container.getAttribute('data-loop') === 'true';
                const speed = parseFloat(container.getAttribute('data-speed')) || 1;
                const renderer = container.getAttribute('data-renderer') || 'svg';
                const direction = parseInt(container.getAttribute('data-direction')) || 1;
                const hover = container.getAttribute('data-hover') === 'true';
                const click = container.getAttribute('data-click') === 'true';
                
                const animationElement = container.querySelector('.lottie-animation');
                const loadingElement = container.querySelector('.lottie-loading');
                const errorElement = container.querySelector('.lottie-error');
                const fallbackElement = container.querySelector('.lottie-fallback');
                
                if (!animationPath) {
                    console.warn('Lottie 动画路径未指定');
                    if (errorElement) errorElement.style.display = 'block';
                    return;
                }
                
                // 显示加载状态
                if (loadingElement) loadingElement.style.display = 'block';
                
                // 动画配置
                const animationConfig = {
                    container: animationElement,
                    renderer: renderer,
                    loop: loop,
                    autoplay: autoplay,
                    path: animationPath,
                    rendererSettings: {
                        preserveAspectRatio: 'xMidYMid slice'
                    }
                };
                
                // 创建动画
                const animation = lottie.loadAnimation(animationConfig);
                
                // 动画加载完成
                animation.addEventListener('DOMLoaded', function() {
                    if (loadingElement) loadingElement.style.display = 'none';
                    animation.setSpeed(speed);
                    if (direction === -1) {
                        animation.setDirection(-1);
                    }
                });
                
                // 动画加载失败
                animation.addEventListener('data_failed', function() {
                    if (loadingElement) loadingElement.style.display = 'none';
                    if (errorElement) errorElement.style.display = 'block';
                    if (fallbackElement) fallbackElement.style.display = 'block';
                });
                
                // 鼠标悬停控制
                if (hover) {
                    container.addEventListener('mouseenter', function() {
                        animation.play();
                    });
                    container.addEventListener('mouseleave', function() {
                        animation.pause();
                    });
                }
                
                // 点击控制
                if (click) {
                    container.addEventListener('click', function() {
                        if (animation.isPaused) {
                            animation.play();
                        } else {
                            animation.pause();
                        }
                    });
                }
                
                // 将动画实例存储到容器中，方便外部访问
                container.lottieAnimation = animation;
            });
        });
    </script>


    <!-- Footer -->
    <footer class="bg-white border-top p-3 text-muted small">
        <div class="container">
        <div class="row align-items-center justify-content-between">
            <div>
                <span class="navbar-brand mr-2 mb-0"><strong>黑石的知识库</strong></span>
                <span>Copyright © <script>document.write(new Date().getFullYear())</script>.</span>

                <!--  Github Repo Star Btn-->
                <a class="text-dark ml-1" target="_blank" href="https://github.com/blackstoneblackstone/blackstoneblackstone.github.io"><i class="fab fa-github"></i> Github</a>

            </div>
            <div>
                黑石的知识库 - https://yondu.vip
            </div>
        </div>
        </div>
    </footer>

    {% include tracking-footer.html %}

</body>

</html>
